<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">CAS单点登陆的基本实现 | nana</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "娜娜nana";
  mashiro_option.author_name = "nana";
  mashiro_option.site_url = "https://www.masamiaoi.top/";
  mashiro_option.v_appId = "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz";
  mashiro_option.v_appKey = "mgOpfzbkHYqU92CV4IDlAUHQ";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://ae01.alicdn.com/kf/Hc9997bb33e10435391f8b22f3e04cdaaF.jpg".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
</head>
</html>
<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://www.masamiaoi.top/">
          <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6https://ae01.alicdn.com/kf/H3ec49ae17f1d469eb6c0d9133db61c27Q.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>勿因未候日光暖，擅自轻言世间寒。</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="https://github.com/MASAMIAOI" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://github.com/MASAMIAOI" target="_blank" class="social-github" title="sina">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/sina.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://github.com/MASAMIAOI" target="_blank" class="social-github" title="wangyiyun">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/wangyiyun.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://github.com/MASAMIAOI" target="_blank" class="social-github" title="zhihu">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/zhihu.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://github.com/MASAMIAOI" target="_blank" class="social-github" title="email">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/email.svg">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/custom/wechat.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">娜娜</span>
            <span class="shironeko">nana</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/技术/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/tags/悦读/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          书单
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://ae01.alicdn.com/kf/Hc9997bb33e10435391f8b22f3e04cdaaF.jpg);" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://ae01.alicdn.com/kf/Hc9997bb33e10435391f8b22f3e04cdaaF.jpg">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      CAS单点登陆的基本实现</h1>
      <p class="entry-census">
        <span>
          <a href="hojun.cn">
            <img src="https://ae01.alicdn.com/kf/Hc9997bb33e10435391f8b22f3e04cdaaF.jpg">
          </a>
        </span>
        <span>
          <a href="hojun.cn">nana</a>
        </span>
        <span class="bull">
        ·</span>
        2019-7-11<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <h2 id="一-：单点登陆的基本实现"><a href="#一-：单点登陆的基本实现" class="headerlink" title="一 ：单点登陆的基本实现"></a>一 ：单点登陆的基本实现</h2><h4 id="1-1-单点登陆的概述"><a href="#1-1-单点登陆的概述" class="headerlink" title="1.1 单点登陆的概述"></a>1.1 单点登陆的概述</h4><p><img src="https://ae01.alicdn.com/kf/H7107119399574458a2d5dcdf2afc14e1C.jpg" alt></p>
<h4 id="1-2-CAS-的概述"><a href="#1-2-CAS-的概述" class="headerlink" title="1.2 CAS 的概述"></a>1.2 CAS 的概述</h4><p>cas 具有以下特点 ：</p>
<ul>
<li>开源的企业级单点登录解决方案。 </li>
<li>CAS Server 为需要独立部署的 Web 应用。</li>
<li>CAS Client 支持非常多的客户端(这里指单点登录系统中的各个 Web 应用)，包括 Java, .Net, PHP, Perl, Apache, uPortal, Ruby 等 </li>
</ul>
<p><img src="https://ae01.alicdn.com/kf/H223fa792f94947239b1ac51a0fe98961D.jpg" alt></p>
<p>SSO单点登录访问流程主要有以下步骤 ：</p>
<ol>
<li><p>访问服务：SSO客户端发送请求访问应用系统提供的服务资源。</p>
</li>
<li><p>定向认证：SSO客户端会重定向用户请求到SSO服务器。</p>
</li>
<li><p>用户认证：用户身份认证。</p>
</li>
<li><p>发放票据：SSO服务器会产生一个随机的Service Ticket。</p>
</li>
<li><p>验证票据：SSO服务器验证票据Service Ticket的合法性，验证通过后，允许客户端访问服务。</p>
</li>
<li><p>传输用户信息：SSO服务器验证票据通过后，传输用户认证结果信息给客户端。</p>
</li>
</ol>
<h4 id="1-3-CAS服务部署"><a href="#1-3-CAS服务部署" class="headerlink" title="1.3 CAS服务部署"></a>1.3 CAS服务部署</h4><p>Cas服务端其实就是一个war包。</p>
<p>在资源\cas\source\cas-server-4.0.0-release\cas-server-4.0.0\modules目录下</p>
<p>cas-server-webapp-4.0.0.war  将其改名为cas.war放入tomcat目录下的webapps下。启动tomcat自动解压war包。浏览器输入<a href="http://localhost:8080/cas/login" target="_blank" rel="noopener">http://localhost:8080/cas/login</a>  ，可看到登录页面</p>
<p><img src="https://ae01.alicdn.com/kf/Hfbae6c4da4be40368d618037e743c37a2.jpg" alt></p>
<p>这里有个固定的用户名和密码   casuser /Mellon</p>
<p>登录成功后会跳到登录成功的提示页面</p>
<p><img src="https://ae01.alicdn.com/kf/Hd1572285a34d4f5bb33daaed13b1b04aH.jpg" alt></p>
<h4 id="1-4-CAS-服务端配置"><a href="#1-4-CAS-服务端配置" class="headerlink" title="1.4 CAS 服务端配置"></a>1.4 CAS 服务端配置</h4><h5 id="1-4-1-端口配置"><a href="#1-4-1-端口配置" class="headerlink" title="1.4.1 端口配置"></a>1.4.1 端口配置</h5><p>如果我们不希望用8080端口访问CAS, 可以修改端口 </p>
<ul>
<li>修改TOMCAT的端口 </li>
</ul>
<p>打开tomcat 目录 conf\server.xml  找到下面的配置  </p>
<p><img src="https://ae01.alicdn.com/kf/Hcda1805acdf341e8a1a48ac70320dc3eD.jpg" alt></p>
<p>将端口8080，改为自己想要使用的端口（这里设置为了9100）</p>
<ul>
<li>修改CAS配置文件 </li>
</ul>
<p>修改cas的WEB-INF/cas.properties  </p>
<pre><code class="xml">server.name=http://localhost:9100</code></pre>
<h5 id="1-4-2-去除-https-认证"><a href="#1-4-2-去除-https-认证" class="headerlink" title="1.4.2 去除 https 认证"></a>1.4.2 去除 https 认证</h5><p>​    CAS默认使用的是HTTPS协议，如果使用HTTPS协议需要SSL安全证书（需向特定的机构申请和购买） 。如果对安全要求不高或是在开发测试阶段，可使用HTTP协议。我们这里讲解通过修改配置，让CAS使用HTTP协议。</p>
<ul>
<li>修改cas的WEB-INF/deployerConfigContext.xml </li>
</ul>
<p>找到下面的配置 </p>
<pre><code class="xmnl">&lt;bean class=&quot;org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler&quot;
p:httpClient-ref=&quot;httpClient&quot;/&gt;</code></pre>
<p>这里需要增加参数 <a href>p:requireSecure=”false”</a> ，<a href>requireSecure</a> 属性意思为是否需要安全验证，即HTTPS，false为不采用 </p>
<ul>
<li>修改cas的/WEB-INF/<a href="http://lib.csdn.net/base/javaee" target="_blank" rel="noopener"><strong>spring</strong></a>-configuration/ticketGrantingTicketCookieGenerator.xml  </li>
</ul>
<p>找到下面配置 </p>
<pre><code class="xml">&lt;bean id=&quot;ticketGrantingTicketCookieGenerator&quot; class=&quot;org.jasig.cas.web.support.CookieRetrievingCookieGenerator&quot;
      p:cookieSecure=&quot;true&quot;
      p:cookieMaxAge=&quot;-1&quot;
      p:cookieName=&quot;CASTGC&quot;
      p:cookiePath=&quot;/cas&quot; /&gt;</code></pre>
<pre><code>参数p:cookieSecure=&quot;true&quot;，同理为HTTPS验证相关，TRUE为采用HTTPS验证，FALSE为不采用https验证。

参数p:cookieMaxAge=&quot;-1&quot;，是COOKIE的最大生命周期，-1为无生命周期，即只在当前打开的窗口有效，关闭或重新打开其它窗口，仍会要求验证。可以根据需要修改为大于0的数字，比如3600等，意思是在3600秒内，打开任意窗口，都不需要验证。

我们这里将cookieSecure改为false ,  cookieMaxAge 改为3600</code></pre><ul>
<li>修改cas的WEB-INF/spring-configuration/warnCookieGenerator.xml backgro</li>
</ul>
<p>找到下面配置 </p>
<pre><code class="xml">&lt;bean id=&quot;warnCookieGenerator&quot; class=&quot;org.jasig.cas.web.support.CookieRetrievingCookieGenerator&quot;
p:cookieSecure=&quot;true&quot;
p:cookieMaxAge=&quot;-1&quot;
p:cookieName=&quot;CASPRIVACY&quot;
p:cookiePath=&quot;/cas&quot; /&gt;</code></pre>
<p>我们这里将cookieSecure改为false ,  cookieMaxAge 改为3600 </p>
<h5 id="1-4-3-CAS入门端小-Demo"><a href="#1-4-3-CAS入门端小-Demo" class="headerlink" title="1.4.3 CAS入门端小 Demo"></a>1.4.3 CAS入门端小 Demo</h5><p>将上面的修改好之后我们就可以尝试一个小案例</p>
<ul>
<li>客户端工程 1 搭建</li>
</ul>
<p>（1）搭建工程引入依赖 </p>
<p>创建Maven工程 （war）casclient_demo1  引入cas客户端依赖并制定tomcat运行端口为9001 </p>
<pre><code class="xml">    &lt;dependencies&gt;
        &lt;!-- cas --&gt;  
        &lt;dependency&gt;  
            &lt;groupId&gt;org.jasig.cas.client&lt;/groupId&gt;  
            &lt;artifactId&gt;cas-client-core&lt;/artifactId&gt;  
            &lt;version&gt;3.3.3&lt;/version&gt;  
        &lt;/dependency&gt;          
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
            &lt;version&gt;2.5&lt;/version&gt;  
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;  
  &lt;build&gt;  
      &lt;plugins&gt;
          &lt;plugin&gt;  
              &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;  
              &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;  
              &lt;version&gt;2.3.2&lt;/version&gt;  
              &lt;configuration&gt;  
                  &lt;source&gt;1.7&lt;/source&gt;  
                  &lt;target&gt;1.7&lt;/target&gt;  
              &lt;/configuration&gt;  
          &lt;/plugin&gt;  
          &lt;plugin&gt;
                &lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt;
                &lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;!-- 指定端口 --&gt;
                    &lt;port&gt;9001&lt;/port&gt;
                    &lt;!-- 请求路径 --&gt;
                    &lt;path&gt;/&lt;/path&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
      &lt;/plugins&gt;  
    &lt;/build&gt;</code></pre>
<p>（2）添加web.xml </p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
    xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
    xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;
    version=&quot;2.5&quot;&gt;    
    &lt;!-- 用于单点退出，该过滤器用于实现单点登出功能，可选配置 --&gt;  
    &lt;listener&gt;  
     &lt;listener-class&gt;org.jasig.cas.client.session.SingleSignOutHttpSessionListener&lt;/listener-class&gt;  
    &lt;/listener&gt;  
    &lt;!-- 该过滤器用于实现单点登出功能，可选配置。 --&gt;  
    &lt;filter&gt;  
        &lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;  
       &lt;filter-class&gt;org.jasig.cas.client.session.SingleSignOutFilter&lt;/filter-class&gt;  
    &lt;/filter&gt;  
    &lt;filter-mapping&gt;  
        &lt;filter-name&gt;CAS Single Sign Out Filter&lt;/filter-name&gt;  
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;  
    &lt;/filter-mapping&gt;  
    &lt;!-- 该过滤器负责用户的认证工作，必须启用它 --&gt;  
    &lt;filter&gt;  
        &lt;filter-name&gt;CASFilter&lt;/filter-name&gt;       &lt;filter-class&gt;org.jasig.cas.client.authentication.AuthenticationFilter&lt;/filter-class&gt;  
        &lt;init-param&gt;  
            &lt;param-name&gt;casServerLoginUrl&lt;/param-name&gt;  
            &lt;param-value&gt;http://localhost:9100/cas/login&lt;/param-value&gt;  
            &lt;!--这里的server是服务端的IP --&gt;  
        &lt;/init-param&gt;  
        &lt;init-param&gt;  
            &lt;param-name&gt;serverName&lt;/param-name&gt;  
            &lt;param-value&gt;http://localhost:9001&lt;/param-value&gt;
        &lt;/init-param&gt;  
    &lt;/filter&gt;  
    &lt;filter-mapping&gt;  
        &lt;filter-name&gt;CASFilter&lt;/filter-name&gt;  
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;  
    &lt;/filter-mapping&gt;  
    &lt;!-- 该过滤器负责对Ticket的校验工作，必须启用它 --&gt;  
    &lt;filter&gt;  
        &lt;filter-name&gt;CAS Validation Filter&lt;/filter-name&gt;  
        &lt;filter-class&gt;     org.jasig.cas.client.validation.Cas20ProxyReceivingTicketValidationFilter&lt;/filter-class&gt;  
        &lt;init-param&gt;  
            &lt;param-name&gt;casServerUrlPrefix&lt;/param-name&gt;  
            &lt;param-value&gt;http://localhost:9100/cas&lt;/param-value&gt;  
        &lt;/init-param&gt;  
        &lt;init-param&gt;  
            &lt;param-name&gt;serverName&lt;/param-name&gt;  
            &lt;param-value&gt;http://localhost:9001&lt;/param-value&gt;
        &lt;/init-param&gt;  
    &lt;/filter&gt;  
    &lt;filter-mapping&gt;  
        &lt;filter-name&gt;CAS Validation Filter&lt;/filter-name&gt;  
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;  
    &lt;/filter-mapping&gt;  
    &lt;!-- 该过滤器负责实现HttpServletRequest请求的包裹， 比如允许开发者通过HttpServletRequest的getRemoteUser()方法获得SSO登录用户的登录名，可选配置。 --&gt;  
    &lt;filter&gt;  
        &lt;filter-name&gt;CAS HttpServletRequest Wrapper Filter&lt;/filter-name&gt;  
        &lt;filter-class&gt;  
            org.jasig.cas.client.util.HttpServletRequestWrapperFilter&lt;/filter-class&gt;  
    &lt;/filter&gt;  
    &lt;filter-mapping&gt;  
        &lt;filter-name&gt;CAS HttpServletRequest Wrapper Filter&lt;/filter-name&gt;  
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;  
    &lt;/filter-mapping&gt;  
    &lt;!-- 该过滤器使得开发者可以通过org.jasig.cas.client.util.AssertionHolder来获取用户的登录名。 比如AssertionHolder.getAssertion().getPrincipal().getName()。 --&gt;  
    &lt;filter&gt;  
        &lt;filter-name&gt;CAS Assertion Thread Local Filter&lt;/filter-name&gt;       &lt;filter-class&gt;org.jasig.cas.client.util.AssertionThreadLocalFilter&lt;/filter-class&gt;  
    &lt;/filter&gt;  
    &lt;filter-mapping&gt;  
        &lt;filter-name&gt;CAS Assertion Thread Local Filter&lt;/filter-name&gt;  
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;  
    &lt;/filter-mapping&gt;  
&lt;/web-app&gt;</code></pre>
<p>（3）编写index.jsp</p>
<pre><code class="jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=utf-8&quot;
    pageEncoding=&quot;utf-8&quot;%&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
&lt;title&gt;一测试&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
欢迎来到一测试一
&lt;%=request.getRemoteUser()%&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>request.getRemoteUser()为获取远程登录名   账户密码 为上面的内部密码</p>
<ul>
<li>客户端工程 2 搭建</li>
</ul>
<pre><code>（1）创建Maven工程 （war）casclient_demo2  引入cas客户端依赖并制定tomcat运行端口为9002

（2）创建web.xml，参照casclient_demo1  ,将serverName的值改为http://localhost:9002，一共两处

（3）创建index.jsp  ,内容显示“欢迎来到二测试二”</code></pre><ul>
<li>单点登录测试</li>
</ul>
<pre><code>（1）启动cas部署的tomcat  

（2）启动客户端工程1和客户端工程2

（3）地址栏输入http://localhost:9001/   和http://localhost:9002/  ，地址均会跳转到CAS登录页

（4）输入用户名和密码后，页面跳转回9002  ，再次访问9001也可以打开主页面。</code></pre><ul>
<li>单点登出测试</li>
</ul>
<p>地址栏输入  <a href="http://localhost:9000/cas/logout" target="_blank" rel="noopener">http://localhost:9100/cas/logout</a> </p>
<p>即可看到退出后的提示页面</p>
<p>我们可以将这个链接添加到index.jsp中 </p>
<pre><code class="xml">&lt;a href=&quot;http://localhost:9100/cas/logout&quot;&gt;退出登录&lt;/a&gt;</code></pre>
<p>但我们更希望退出登录后，能自动跳转到某个页面，那如何处理呢？</p>
<p>修改cas系统的配置文件cas-servlet.xml</p>
<pre><code class="xml">  &lt;bean id=&quot;logoutAction&quot; class=&quot;org.jasig.cas.web.flow.LogoutAction&quot;
        p:servicesManager-ref=&quot;servicesManager&quot;
        p:followServiceRedirects=&quot;${cas.logout.followServiceRedirects:true}&quot;/&gt;</code></pre>
<p>改为true后，可以在退出时跳转页面到目标页面，修改index.jsp的退出链接 </p>
<pre><code class="xml">&lt;a href=&quot;http://localhost:9100/cas/logout?service=http://www.baidu.com&quot;&gt;退出登录&lt;/a&gt;</code></pre>
<h4 id="1-5-服务端数据源配置"><a href="#1-5-服务端数据源配置" class="headerlink" title="1.5 服务端数据源配置"></a>1.5 服务端数据源配置</h4><h5 id="1-5-1-需求"><a href="#1-5-1-需求" class="headerlink" title="1.5.1 需求"></a>1.5.1 需求</h5><p>我们想让用户密码从我们的数据库中获取做验证</p>
<h5 id="1-5-2-配置数据源"><a href="#1-5-2-配置数据源" class="headerlink" title="1.5.2 配置数据源"></a>1.5.2 配置数据源</h5><ul>
<li>修改cas服务端中web-inf下deployerConfigContext.xml ，添加如下配置 </li>
</ul>
<pre><code class="xml">&lt;!--数据库的配置 这里用的是 c3po--&gt;
&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;  
              p:driverClass=&quot;com.mysql.jdbc.Driver&quot;  
              p:jdbcUrl=&quot;jdbc:mysql://127.0.0.1:3306/pinyougoudb?characterEncoding=utf8&quot;  
              p:user=&quot;root&quot;  
              p:password=&quot;123456&quot; /&gt; 
&lt;!--这里是密码编码  采用的是 md5 的加密--&gt;
&lt;bean id=&quot;passwordEncoder&quot; 
class=&quot;org.jasig.cas.authentication.handler.DefaultPasswordEncoder&quot;  
        c:encodingAlgorithm=&quot;MD5&quot;  
        p:characterEncoding=&quot;UTF-8&quot; /&gt;  
&lt;!--这里是 加载以上两个 内容的 bean 并且 sql 语句在这里填写，找到自己的密码--&gt;
&lt;bean id=&quot;dbAuthHandler&quot;  
          class=&quot;org.jasig.cas.adaptors.jdbc.QueryDatabaseAuthenticationHandler&quot;  
          p:dataSource-ref=&quot;dataSource&quot;  
          p:sql=&quot;select password from tb_user where username = ?&quot;  
          p:passwordEncoder-ref=&quot;passwordEncoder&quot;/&gt;  </code></pre>
<p>然后在配置文件开始部分找到如下配置 </p>
<pre><code class="xml"> &lt;bean id=&quot;authenticationManager&quot; class=&quot;org.jasig.cas.authentication.PolicyBasedAuthenticationManager&quot;&gt;
        &lt;constructor-arg&gt;
            &lt;map&gt;               
                &lt;entry key-ref=&quot;proxyAuthenticationHandler&quot; value-ref=&quot;proxyPrincipalResolver&quot; /&gt;
                &lt;entry key-ref=&quot;primaryAuthenticationHandler&quot; value-ref=&quot;primaryPrincipalResolver&quot; /&gt;
            &lt;/map&gt;
        &lt;/constructor-arg&gt;      
        &lt;property name=&quot;authenticationPolicy&quot;&gt;
            &lt;bean class=&quot;org.jasig.cas.authentication.AnyAuthenticationPolicy&quot; /&gt;
        &lt;/property&gt;
&lt;/bean&gt;</code></pre>
<p>其中</p>
<pre><code class="xml"> &lt;entry key-ref=&quot;primaryAuthenticationHandler&quot; value-ref=&quot;primaryPrincipalResolver&quot; /&gt;</code></pre>
<p>一句是使用固定的用户名和密码，我们在下面可以看到这两个bean ,如果我们使用数据库认证用户名和密码，需要将这句注释掉。</p>
<p>添加下面这一句配置</p>
<pre><code class="xml">&lt;entry key-ref=&quot;dbAuthHandler&quot; value-ref=&quot;primaryPrincipalResolver&quot;/&gt;</code></pre>
<ul>
<li>将以下三个jar包放入webapps\cas\WEB-INF\lib下 </li>
</ul>
<p><img src="https://ae01.alicdn.com/kf/Ha684bdd3d82244238a00514af22f10caR.jpg" alt></p>
<p>然后就可以测试登录啦</p>
<h4 id="1-6-服务端页面修改"><a href="#1-6-服务端页面修改" class="headerlink" title="1.6 服务端页面修改"></a>1.6 服务端页面修改</h4><h5 id="1-6-1-需求"><a href="#1-6-1-需求" class="headerlink" title="1.6.1 需求"></a>1.6.1 需求</h5><p>当我们不想使用系统默认的同意认证界面，便可以换做自己想要统一单点登录的页面</p>
<h5 id="1-6-2-拷贝资源"><a href="#1-6-2-拷贝资源" class="headerlink" title="1.6.2 拷贝资源"></a>1.6.2 拷贝资源</h5><p>（1）将登陆页login.html拷贝到cas系统下WEB-INF\view\jsp\default\ui 目录下</p>
<p>（2）将css  js等文件夹拷贝到  cas目录下</p>
<p>（3） 将原来的casLoginView.jsp 改名（可以为之后的修改操作做参照），将login.html改名为casLoginView.jsp </p>
<h5 id="1-6-3-修改页面"><a href="#1-6-3-修改页面" class="headerlink" title="1.6.3 修改页面"></a>1.6.3 修改页面</h5><p><strong>编辑casLoginView.jsp</strong> <strong>内容</strong> </p>
<p>（1）添加指令 </p>
<pre><code class="xml">&lt;%@ page pageEncoding=&quot;UTF-8&quot; %&gt;
&lt;%@ page contentType=&quot;text/html; charset=UTF-8&quot; %&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;%@ taglib prefix=&quot;spring&quot; uri=&quot;http://www.springframework.org/tags&quot; %&gt;
&lt;%@ taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot; %&gt;
&lt;%@ taglib prefix=&quot;fn&quot; uri=&quot;http://java.sun.com/jsp/jstl/functions&quot; %&gt;</code></pre>
<p>（2）修改form标签 </p>
<pre><code class="xml">&lt;form:form method=&quot;post&quot; id=&quot;fm1&quot; commandName=&quot;${commandName}&quot; htmlEscape=&quot;true&quot; class=&quot;sui-form&quot;&gt;
......
&lt;/form:form&gt;</code></pre>
<p>（3）修改用户名框</p>
<pre><code class="xml">&lt;form:input id=&quot;username&quot; tabindex=&quot;1&quot; 
    accesskey=&quot;${userNameAccessKey}&quot; path=&quot;username&quot; autocomplete=&quot;off&quot; htmlEscape=&quot;true&quot; 
    placeholder=&quot;邮箱/用户名/手机号&quot; class=&quot;span2 input-xfat&quot; /&gt;</code></pre>
<p>（4）修改密码框 </p>
<pre><code class="xml"> &lt;form:password  id=&quot;password&quot; tabindex=&quot;2&quot; path=&quot;password&quot; 
      accesskey=&quot;${passwordAccessKey}&quot; htmlEscape=&quot;true&quot; autocomplete=&quot;off&quot; 
      placeholder=&quot;请输入密码&quot; class=&quot;span2 input-xfat&quot;   /&gt;</code></pre>
<p>（5）修改登陆按钮</p>
<pre><code class="xml">&lt;input type=&quot;hidden&quot; name=&quot;lt&quot; value=&quot;${loginTicket}&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;execution&quot; value=&quot;${flowExecutionKey}&quot; /&gt;
&lt;input type=&quot;hidden&quot; name=&quot;_eventId&quot; value=&quot;submit&quot; /&gt;
&lt;input class=&quot;sui-btn btn-block btn-xlarge btn-danger&quot; accesskey=&quot;l&quot; value=&quot;登陆&quot; type=&quot;submit&quot; /&gt;</code></pre>
<p>（6） 然后就可以看到效果啦</p>
<h5 id="1-6-4-修改错误提示"><a href="#1-6-4-修改错误提示" class="headerlink" title="1.6.4 修改错误提示"></a>1.6.4 修改错误提示</h5><p>在表单内加入错误提示框 </p>
<pre><code class="xml">&lt;form:errors path=&quot;*&quot; id=&quot;msg&quot; cssClass=&quot;errors&quot; element=&quot;div&quot; htmlEscape=&quot;false&quot; /&gt;</code></pre>
<p>测试：输入错误的用户名和密码，提示是英文。这个提示信息是在WEB-INF\classes目录下的messages.properties文件中 </p>
<pre><code class="xml">authenticationFailure.AccountNotFoundException=Invalid credentials.
authenticationFailure.FailedLoginException=Invalid credentials.</code></pre>
<p>设置国际化为zn_CN  ,修改cas-servlet.xml</p>
<pre><code class="xml">&lt;bean id=&quot;localeResolver&quot; class=&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot; p:defaultLocale=&quot;zh_CN&quot; /&gt;</code></pre>
<p>我们需要将此信息拷贝到messages_zh_CN.properties下，并改为中文提示（转码） </p>
<pre><code class="xml">authenticationFailure.AccountNotFoundException=\u7528\u6237\u4E0D\u5B58\u5728.
authenticationFailure.FailedLoginException=\u5BC6\u7801\u9519\u8BEF.</code></pre>
<p>第一个是用户名不存在时的错误提示</p>
<p>第二个是密码错误的提示</p>
<h2 id="二-：CAS-客户端-与-SpringSecurity-集成"><a href="#二-：CAS-客户端-与-SpringSecurity-集成" class="headerlink" title="二 ：CAS 客户端 与 SpringSecurity 集成"></a>二 ：CAS 客户端 与 SpringSecurity 集成</h2><h3 id="1，搭建客户端casclient-demo3，引入spring依赖和spring-secrity-相关依赖-，tomcat端口设置为9003"><a href="#1，搭建客户端casclient-demo3，引入spring依赖和spring-secrity-相关依赖-，tomcat端口设置为9003" class="headerlink" title="1，搭建客户端casclient_demo3，引入spring依赖和spring secrity 相关依赖 ，tomcat端口设置为9003"></a>1，搭建客户端casclient_demo3，引入spring依赖和spring secrity 相关依赖 ，tomcat端口设置为9003</h3><p>pom.xml </p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;project_demo&lt;/artifactId&gt;
        &lt;groupId&gt;com.zy&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;artifactId&gt;casclient_demo3&lt;/artifactId&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;

    &lt;properties&gt;
        &lt;spring.version&gt;4.2.4.RELEASE&lt;/spring.version&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;!--spring--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!--security--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-web&lt;/artifactId&gt;
            &lt;version&gt;4.1.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-config&lt;/artifactId&gt;
            &lt;version&gt;4.1.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!--servlet--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
            &lt;version&gt;2.5&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;

        &lt;!--spring和cas集成需要的两个jar包--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-cas&lt;/artifactId&gt;
            &lt;version&gt;4.1.0.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.jasig.cas.client&lt;/groupId&gt;
            &lt;artifactId&gt;cas-client-core&lt;/artifactId&gt;
            &lt;version&gt;3.3.3&lt;/version&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
                    &lt;artifactId&gt;log4j-over-slf4j&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;!-- java编译插件 --&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;version&gt;3.2&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.8&lt;/source&gt;
                    &lt;target&gt;1.8&lt;/target&gt;
                    &lt;encoding&gt;UTF-8&lt;/encoding&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt;
                &lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;!-- 指定端口 --&gt;
                    &lt;port&gt;9003&lt;/port&gt;
                    &lt;!-- 请求路径 --&gt;
                    &lt;path&gt;/&lt;/path&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre>
<h3 id="2，修改web-xml-，添加过滤器等配置"><a href="#2，修改web-xml-，添加过滤器等配置" class="headerlink" title="2，修改web.xml ，添加过滤器等配置"></a>2，修改web.xml ，添加过滤器等配置</h3><p>web.xml </p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;
         xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;
         version=&quot;2.5&quot;&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;classpath:spring-security.xml&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;listener&gt;
        &lt;listener-class&gt;
            org.springframework.web.context.ContextLoaderListener
        &lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;!--security过滤器链--&gt;
    &lt;filter&gt;
        &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
        &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;


    &lt;!--springMVC DispatcherServlet--&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;!-- 指定加载的配置文件 ，通过参数contextConfigLocation加载--&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
            &lt;param-value&gt;classpath:springmvc.xml&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;
        &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</code></pre>
<h3 id="3，创建配置文件springmvc-xml及spring-security-xml"><a href="#3，创建配置文件springmvc-xml及spring-security-xml" class="headerlink" title="3，创建配置文件springmvc.xml及spring-security.xml"></a>3，创建配置文件springmvc.xml及spring-security.xml</h3><p>resources/springmvc.xml </p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;
       xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd

        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;

    &lt;context:component-scan base-package=&quot;com.zy.demo.controller&quot;/&gt;

    &lt;mvc:annotation-driven/&gt;

&lt;/beans&gt;</code></pre>
<p>resources/spring-security.xml </p>
<pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans:beans xmlns=&quot;http://www.springframework.org/schema/security&quot;
             xmlns:beans=&quot;http://www.springframework.org/schema/beans&quot;
             xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
             xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security.xsd&quot;&gt;


    &lt;!--拦截规则  entry-point-ref为入口点引用 use-expressions默认是true --&gt;
    &lt;http use-expressions=&quot;false&quot; entry-point-ref=&quot;casProcessingFilterEntryPoint&quot;&gt;
        &lt;!--允许匿名访问的连接地址--&gt;
        &lt;intercept-url pattern=&quot;/public/*.do&quot; access=&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;&gt;&lt;/intercept-url&gt;
        &lt;!-- /* 当前级别目标 子目录是不拦截--&gt;
        &lt;!--如果是ROLE_ADMIN则不拦截admin文件夹下的--&gt;
        &lt;intercept-url pattern=&quot;/admin/**&quot; access=&quot;ROLE_ADMIN&quot;&gt;&lt;/intercept-url&gt;
        &lt;!--如果是ROLE_LEADER则不拦截leader文件夹下的--&gt;
        &lt;intercept-url pattern=&quot;/leader/**&quot; access=&quot;ROLE_LEADER&quot;&gt;&lt;/intercept-url&gt;
        &lt;!--如果两个角色都有 所有的都不拦截--&gt;
        &lt;intercept-url pattern=&quot;/**&quot; access=&quot;ROLE_ADMIN,ROLE_LEADER&quot;&gt;&lt;/intercept-url&gt;
        &lt;!--关闭防CSRF攻击--&gt;
        &lt;csrf disabled=&quot;true&quot;&gt;&lt;/csrf&gt;

        &lt;!--配置认证过滤器--&gt;
        &lt;!-- custom-filter为过滤器, position 表示将过滤器放在指定的位置上, before表示放在指定位置之前, after表示放在指定的位置之后  --&gt;
        &lt;custom-filter ref=&quot;casAuthenticationFilter&quot; position=&quot;CAS_FILTER&quot;/&gt;
        &lt;custom-filter ref=&quot;requestSingleLogoutFilter&quot; before=&quot;LOGOUT_FILTER&quot;/&gt;
        &lt;custom-filter ref=&quot;singleLogoutFilter&quot; before=&quot;CAS_FILTER&quot;/&gt;
    &lt;/http&gt;


    &lt;!-- CAS入口点 开始 --&gt;
    &lt;!--入口点的引用--&gt;
    &lt;beans:bean id=&quot;casProcessingFilterEntryPoint&quot;
                class=&quot;org.springframework.security.cas.web.CasAuthenticationEntryPoint&quot;&gt;
        &lt;!-- 单点登录服务器登录URL --&gt;
        &lt;!--&lt;beans:property name=&quot;loginUrl&quot; value=&quot;http://localhost:9100/cas/login&quot;/&gt;--&gt;
        &lt;beans:property name=&quot;loginUrl&quot; value=&quot;http://192.168.44.31:9100/cas/login&quot;/&gt;
        &lt;beans:property name=&quot;serviceProperties&quot; ref=&quot;serviceProperties&quot;/&gt;
    &lt;/beans:bean&gt;

    &lt;beans:bean id=&quot;serviceProperties&quot; class=&quot;org.springframework.security.cas.ServiceProperties&quot;&gt;
        &lt;!--service 配置自身工程的根地址+/login/cas   --&gt;
        &lt;beans:property name=&quot;service&quot; value=&quot;http://localhost:9003/login/cas&quot;/&gt;
    &lt;/beans:bean&gt;
    &lt;!-- CAS入口点 结束 --&gt;


    &lt;!-- 认证过滤器 开始 --&gt;
    &lt;beans:bean id=&quot;casAuthenticationFilter&quot; class=&quot;org.springframework.security.cas.web.CasAuthenticationFilter&quot;&gt;
        &lt;beans:property name=&quot;authenticationManager&quot; ref=&quot;authenticationManager&quot;/&gt;
    &lt;/beans:bean&gt;

    &lt;!-- 认证管理器 --&gt;
    &lt;authentication-manager alias=&quot;authenticationManager&quot;&gt;
        &lt;authentication-provider ref=&quot;casAuthenticationProvider&quot;&gt;
        &lt;/authentication-provider&gt;
    &lt;/authentication-manager&gt;

    &lt;!-- 认证提供者 --&gt;
    &lt;beans:bean id=&quot;casAuthenticationProvider&quot;
                class=&quot;org.springframework.security.cas.authentication.CasAuthenticationProvider&quot;&gt;
        &lt;beans:property name=&quot;authenticationUserDetailsService&quot;&gt;
            &lt;beans:bean class=&quot;org.springframework.security.core.userdetails.UserDetailsByNameServiceWrapper&quot;&gt;
                &lt;beans:constructor-arg ref=&quot;userDetailsService&quot;/&gt;
            &lt;/beans:bean&gt;
        &lt;/beans:property&gt;
        &lt;beans:property name=&quot;serviceProperties&quot; ref=&quot;serviceProperties&quot;/&gt;
        &lt;!-- ticketValidator 为票据验证器 --&gt;
        &lt;beans:property name=&quot;ticketValidator&quot;&gt;
            &lt;beans:bean class=&quot;org.jasig.cas.client.validation.Cas20ServiceTicketValidator&quot;&gt;
                &lt;!--&lt;beans:constructor-arg index=&quot;0&quot; value=&quot;http://localhost:9100/cas&quot;/&gt;--&gt;
                &lt;beans:constructor-arg index=&quot;0&quot; value=&quot;http://192.168.44.31:9100/cas&quot;/&gt;
            &lt;/beans:bean&gt;
        &lt;/beans:property&gt;
        &lt;beans:property name=&quot;key&quot; value=&quot;an_id_for_this_auth_provider_only&quot;/&gt;
    &lt;/beans:bean&gt;

    &lt;!--获取授权信息的bean--&gt;
    &lt;!-- 认证类 --&gt;
    &lt;beans:bean id=&quot;userDetailsService&quot; class=&quot;com.zy.demo.service.UserDetailsServiceImpl&quot;/&gt;
    &lt;!-- 认证过滤器 结束 --&gt;


    &lt;!--退出的过滤器--&gt;
    &lt;!-- 单点登出  开始  --&gt;
    &lt;beans:bean id=&quot;singleLogoutFilter&quot; class=&quot;org.jasig.cas.client.session.SingleSignOutFilter&quot;/&gt;
    &lt;beans:bean id=&quot;requestSingleLogoutFilter&quot;
                class=&quot;org.springframework.security.web.authentication.logout.LogoutFilter&quot;&gt;
        &lt;!--退出登录后跳转到百度--&gt;
        &lt;!--&lt;beans:constructor-arg value=&quot;http://localhost:9100/cas/logout?service=http://www.baidu.com&quot;/&gt;--&gt;
        &lt;beans:constructor-arg value=&quot;http://192.168.44.31:9100/cas/logout?service=http://www.baidu.com&quot;/&gt;
        &lt;beans:constructor-arg&gt;
            &lt;beans:bean class=&quot;org.springframework.security.web.authentication.logout.SecurityContextLogoutHandler&quot;/&gt;
        &lt;/beans:constructor-arg&gt;
        &lt;beans:property name=&quot;filterProcessesUrl&quot; value=&quot;/logout/cas&quot;/&gt;
    &lt;/beans:bean&gt;
    &lt;!-- 单点登出  结束 --&gt;
&lt;/beans:beans&gt;</code></pre>
<h3 id="4，编写认证类java-com-zy-demo-controller-service-UserDetailsServiceImpl-需要实现UserDetailsService接口"><a href="#4，编写认证类java-com-zy-demo-controller-service-UserDetailsServiceImpl-需要实现UserDetailsService接口" class="headerlink" title="4，编写认证类java.com.zy.demo.controller.service.UserDetailsServiceImpl  需要实现UserDetailsService接口"></a>4，编写认证类java.com.zy.demo.controller.service.UserDetailsServiceImpl  需要实现UserDetailsService接口</h3><pre><code class="java">package com.zy.demo.service;

import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Component;

import java.util.ArrayList;
import java.util.List;

/**
 * 使用security控制权限
 */
@Component
public class UserDetailsServiceImpl implements UserDetailsService {

    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        //可以根据用户名取数据库取出来权限
        String authorityLeader = &quot;ROLE_LEADER&quot;;
        String authorityAdmin = &quot;ROLE_ADMIN&quot;;

        //然后授权
        List&lt;GrantedAuthority&gt; authorityList = new ArrayList&lt;&gt;();//权限列表
        //GrantedAuthority authority = new SimpleGrantedAuthority(authorityLeader);//权限
        authorityList.add(new SimpleGrantedAuthority(authorityLeader));
        //authorityList.add(new SimpleGrantedAuthority(authorityAdmin));

        System.out.println(&quot;对用户进行授权&quot;);
        return new User(username, &quot;&quot;, authorityList);
    }
}</code></pre>
<h3 id="5，添加测试html页面"><a href="#5，添加测试html页面" class="headerlink" title="5，添加测试html页面"></a><strong>5，添加测试html页面</strong></h3><p>在webapp下新建leader和admin两个文件夹，并在文件夹内分别新建index.jsp页面（当前页可以建其他页面，此处主要用来演示权限限制）：</p>
<p>webapp/admin/index.jsp</p>
<pre><code class="jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=utf-8&quot;
         pageEncoding=&quot;utf-8&quot; %&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;head&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;admin页面&lt;/h1&gt;
&lt;%=request.getRemoteUser()%&gt;
&lt;br/&gt;
&lt;a href=&quot;/logout/cas&quot;&gt;单点退出&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>webapp/leader/index.jsp </p>
<pre><code class="jsp">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=utf-8&quot;
         pageEncoding=&quot;utf-8&quot; %&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot; &quot;http://www.w3.org/TR/html4/loose.dtd&quot;&gt;
&lt;head&gt;
    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;leader页面&lt;/h1&gt;
&lt;%=request.getRemoteUser()%&gt;
&lt;br/&gt;
&lt;a href=&quot;/logout/cas&quot;&gt;单点退出&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>以上工程搭建完成。</p>
<p>启动项目，浏览器输入localhost:9003/leader/index.jsp，登录后：</p>
<p><img src="http://tva1.sinaimg.cn/large/0060lm7Tly1g5jgtkm5tsj30d407pdg7.jpg" alt></p>
<p>浏览器输入localhost:9003/admin/index.jsp： </p>
<p><img src="http://tva1.sinaimg.cn/large/0060lm7Tly1g5jgtkcf17j30f208ajsa.jpg" alt></p>
<p>拒绝访问，因为我们在<strong>UserDetailsServiceImpl</strong> 只给用户赋予了ROLE_LEADER的权限。 </p>
<h2 id="三-：CAS-单点登陆访问流程"><a href="#三-：CAS-单点登陆访问流程" class="headerlink" title="三 ：CAS 单点登陆访问流程"></a>三 ：CAS 单点登陆访问流程</h2><p><img src="http://tva1.sinaimg.cn/large/0060lm7Tly1g5jgyljqhcj30mg0hiq7i.jpg" alt></p>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏<div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/custom/donate/nana.jpg"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/custom/donate/nana.jpg"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/2019/07/11/HttpClient的基本使用/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://ae01.alicdn.com/kf/Hc9997bb33e10435391f8b22f3e04cdaaF.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://ae01.alicdn.com/kf/Hc9997bb33e10435391f8b22f3e04cdaaF.jpg">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                HttpClient的基本使用</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/2019/07/11/安全框架——SpringSecurity的基本使用/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://ae01.alicdn.com/kf/Hc9997bb33e10435391f8b22f3e04cdaaF.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://ae01.alicdn.com/kf/Hc9997bb33e10435391f8b22f3e04cdaaF.jpg">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                安全框架——SpringSecurity的基本使用</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "GyC3NzMvd0hT9Yyd2hYIC0MN-gzGzoHsz",
        appKey: "mgOpfzbkHYqU92CV4IDlAUHQ",
        path: window.location.pathname,
        placeholder: "你是我一生只会遇见一次的惊喜 ..."
      })
  }
</script>

      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <a href="hojun.cn" class="profile gravatar"><img src="https://ae01.alicdn.com/kf/Hc9997bb33e10435391f8b22f3e04cdaaF.jpg" itemprop="image" alt="nana" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="hojun.cn" itemprop="url" rel="author">nana</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i>一个好奇的人</p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 nana<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2018</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Theme <a href="https://github.com/honjun/hexo-theme-sakura" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Sakura</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> by <a href="https://2heng.xin/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Mashiro</a>&<a href="https://www.hojun.cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a>, Powered by Hexo, Hosted by Coding Pages</a>
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6https://ae01.alicdn.com/kf/H3ec49ae17f1d469eb6c0d9133db61c27Q.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">娜娜nana</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="https://github.com/MASAMIAOI" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="https://github.com/MASAMIAOI" class="fa fa-weibo" target="_blank" style="color: #dd4b39; margin-left:20px"></a>
      
        <a href="https://github.com/MASAMIAOI" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/技术/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/tags/悦读/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  书单
                </a>
              </li>
            
          </ul>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2019 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<div class="aplayer"

    data-id="2660651585"

    data-server="netease"

    data-type="playlist"

    data-fixed="true"

    data-autoplay="false"

    data-loop="all"

    data-order="random"

    data-preload="auto"

    data-volume="0.7"

    data-mutex="true"

</div>
<script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
</body>
</html>